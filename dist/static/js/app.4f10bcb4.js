(function(t){function e(e){for(var n,o,r=e[0],l=e[1],c=e[2],u=0,v=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&v.push(i[o][0]),i[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);d&&d(e);while(v.length)v.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},i={app:0},s=[];function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";a("4b77")},"0439":function(t,e){},"4b77":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("63e6"),a("3aa2"),a("715c"),a("140f");var n=a("430a"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("MyEarth")],1)},s=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hello"},[a("div",{attrs:{id:"display"}},[a("svg",{staticClass:"fill-screen",attrs:{id:"map",xmlns:"http://www.w3.org/2000/svg",version:"1.1"}}),a("canvas",{staticClass:"fill-screen",attrs:{id:"animation"}}),a("canvas",{staticClass:"fill-screen",attrs:{id:"overlay"}}),a("svg",{staticClass:"fill-screen",attrs:{id:"foreground",xmlns:"http://www.w3.org/2000/svg",version:"1.1"}})]),a("div",{attrs:{id:"details"}},[a("p",{attrs:{id:"status"}}),t._m(0),a("div",{staticClass:"invisible",attrs:{id:"menu"}},[t._m(1),t._m(2),t._m(3),t._m(4),a("p",[t._v("操作 | "),a("span",{staticClass:"text-button",attrs:{id:"nav-now",title:"Current Conditions"}},[t._v("Now")]),a("span",{staticClass:"text-button",attrs:{id:"nav-backward-more"}}),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"nav-backward"}},[t._v(" ‹ ")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"nav-forward"}},[t._v(" ›")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"nav-forward-more"}},[t._v(" » ")]),a("span",{staticClass:"text-button",attrs:{id:"show-location",title:"Current Position"},on:{click:t.handleClick}},[t._v("〖◯〗")]),a("span",{staticClass:"text-button",attrs:{id:"option-show-grid",title:"Toggle Grid"}},[t._v("Grid ")])]),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15)]),t._m(16)])])},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"location"}},[a("p",[a("span",{attrs:{id:"location-coord"}}),a("span",{staticClass:"invisible text-button",attrs:{id:"location-close"}},[t._v(" ✕ ")])]),a("p",[a("span",{attrs:{id:"location-wind"}}),a("span",{staticClass:"text-button",attrs:{id:"location-wind-units"}})]),a("p",[a("span",{attrs:{id:"location-value"}}),a("span",{staticClass:"text-button",attrs:{id:"location-value-units"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("日期 | "),a("span",{staticClass:"local",attrs:{id:"data-date"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("描述 | "),a("span",{attrs:{id:"data-layer"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("span",{attrs:{id:"scale-label"}},[t._v("色标 | ")]),a("canvas",{attrs:{id:"scale"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("来源 | "),a("span",{attrs:{id:"data-center"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("模式 | "),a("span",{staticClass:"text-button",attrs:{id:"ncep-mode-enable"}},[t._v("NCEP")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"ocean-mode-enable"}},[t._v("Ocean")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"cma-mode-enable"}},[t._v("CMA")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ncep-mode"},[t._v("位势高度 | "),a("span",{staticClass:"surface text-button",attrs:{id:"surface-level",title:"Surface"}},[t._v("地表")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-1000hPa"}},[t._v("1000")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-850hPa"}},[t._v("850")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-700hPa"}},[t._v("700")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-500hPa"}},[t._v("500")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-250hPa"}},[t._v("250")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-70hPa"}},[t._v("70")]),t._v(" – "),a("span",{staticClass:"surface text-button",attrs:{id:"isobaric-10hPa"}},[t._v("10")]),t._v(" hPa ")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ncep-mode"},[t._v("要素/变量| "),a("span",{staticClass:"text-button",attrs:{id:"overlay-off"}},[t._v("None")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-wind",title:"Wind Speed"}},[t._v("Wind")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-temp",title:"Temperature"}},[t._v("Temp")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-relative_humidity",title:"Relative Humidity"}},[t._v("RH")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-air_density",title:"Air Density"}},[t._v("AD")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-wind_power_density",title:"Wind Power Density"}},[t._v("WPD")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ncep-mode"},[a("span",{staticStyle:{visibility:"hidden"}},[t._v("Overlay")]),t._v(" | "),a("span",{staticClass:"text-button",attrs:{id:"overlay-total_precipitable_water",title:"Total Precipitable Water"}},[t._v("TPW")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-total_cloud_water",title:"Total Cloud Water"}},[t._v("TCW")]),t._v(" –"),a("span",{staticClass:"text-button",attrs:{id:"overlay-mslp",title:"平均海平面气压"}},[t._v("MSLP")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"cma-mode"},[t._v("位势高度 | "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmasurface-level",title:"Surface"}},[t._v("地表")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-1000hPa"}},[t._v("1000")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-850hPa"}},[t._v("850")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-700hPa"}},[t._v("700")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-500hPa"}},[t._v("500")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-250hPa"}},[t._v("250")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-70hPa"}},[t._v("70")]),t._v(" – "),a("span",{staticClass:"cmasurface text-button",attrs:{id:"cmaisobaric-10hPa"}},[t._v("10")]),t._v(" hPa ")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"cma-mode"},[t._v("要素/变量| "),a("span",{staticClass:"text-button",attrs:{id:"overlay-cma-off"}},[t._v("None")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-cmawind",title:"Wind Speed"}},[t._v("Wind")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-cmatemp",title:"Temperature"}},[t._v("Temp")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"cma-mode invisible"},[a("span",{staticStyle:{visibility:"hidden"}},[t._v("Overlay")]),t._v(" |")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ocean-mode invisible"},[t._v("Animate | "),a("span",{staticClass:"text-button",attrs:{id:"animate-currents",title:"Currents"}},[t._v("Currents")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ocean-mode invisible"},[t._v("要素/变量| "),a("span",{staticClass:"text-button",attrs:{id:"overlay-ocean-off"}},[t._v("None")]),t._v(" – "),a("span",{staticClass:"text-button",attrs:{id:"overlay-currents",title:"Currents"}},[t._v("Currents")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"ocean-mode invisible"},[a("span",{staticStyle:{visibility:"hidden"}},[t._v("Overlay")]),t._v(" |")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("投影方式 | "),a("span",{staticClass:"proj text-button",attrs:{id:"atlantis",title:"Atlantis"}},[t._v("A")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"azimuthal_equidistant",title:"Azimuthal Equidistant"}},[t._v("AE")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"conic_equidistant",title:"Conic Equidistant"}},[t._v("CE")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"equirectangular",title:"Equirectangular"}},[t._v("E")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"orthographic",title:"Orthographic"}},[t._v("O")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"stereographic",title:"Stereographic"}},[t._v("S")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"waterman",title:"Waterman Butterfly"}},[t._v("WB")]),t._v(" – "),a("span",{staticClass:"proj text-button",attrs:{id:"winkel3",title:"Winkel Tripel"}},[t._v("W3")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{attrs:{id:"earth"}},[a("span",{staticClass:"text-button",attrs:{id:"show-menu",title:"menu"}},[t._v("控制面板")]),a("span",{staticClass:"invisible",attrs:{id:"progress"}})])}],l=(a("7e8e"),a("e939"),a("1891"),a("f667"),a("61d9"),a("5998"),a("45f6"),a("6c45"),a("5d63"),a("da02"),a("cd46"),{name:"MyEarth",data:function(){return{timerNum:0,coord:[116.2,39.56],SECOND:1e3,MINUTE:60*this.SECOND,HOUR:60*this.MINUTE,MAX_TASK_TIME:100,MIN_SLEEP_TIME:25,MIN_MOVE:4,MOVE_END_WAIT:100,OVERLAY_ALPHA:Math.floor(102),INTENSITY_SCALE_STEP:10,MAX_PARTICLE_AGE:100,PARTICLE_LINE_WIDTH:1,PARTICLE_MULTIPLIER:7,PARTICLE_REDUCTION:.75,FRAME_RATE:40,NULL_WIND_VECTOR:[NaN,NaN,null],HOLE_VECTOR:[NaN,NaN,null],TRANSPARENT_BLACK:[0,0,0,0],REMAINING:"▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫",COMPLETED:"▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪"}},mounted:function(){this.init()},methods:{init:function(){var t=this;try{this.earthJs()}catch(e){this.timerNum++,console.log(e),this.timerNum<10?setTimeout((function(){t.init()}),500):window.alert("初始化失败")}},earthJs:function(){var t=this,e=µ.view(),a=µ.log(),n=function(){var e=d3.select("#status"),n=d3.select("#progress"),i=t.REMAINING.length;return{status:function(t){return e.classed("bad")?e:e.text(t)},error:function(t){var n=t.status?t.status+" "+t.message:t;switch(t.status){case-1:n="Server Down";break;case 404:n="No Data";break}return a.error(t),e.classed("bad",!0).text(n)},reset:function(){return e.classed("bad",!1).text("")},progress:function(e){if(0<=e&&e<1){var a=Math.ceil(e*i),s=t.COMPLETED.substr(0,a)+t.REMAINING.substr(0,i-a);return n.classed("invisible",!1).text(s)}return n.classed("invisible",!0).text("")}}}();function i(){return µ.newAgent().on({reject:n.error,fail:n.error})}var s=µ.buildConfiguration(globes,products.overlayTypes),o=m(),r=i(),l=i(),c=i(),d=i(),u=i(),v=i(),f=i(),p=i();function m(){var a,i=null;function o(t,e){return{type:"click",startMouse:t,startScale:e,manipulator:a.manipulator(t,e)}}var r=d3.behavior.zoom().on("zoomstart",(function(){console.log(a),i=i||o(d3.mouse(this),r.scale())})).on("zoom",(function(){var e=d3.mouse(this),a=d3.event.scale;if(i=i||o(e,1),"click"===i.type||"spurious"===i.type){var n=µ.distance(e,i.startMouse);if(console.log(n),a===i.startScale&&n<t.MIN_MOVE)return void(i.type=n>0?"click":"spurious");d.trigger("moveStart"),i.type="drag"}a!=i.startScale&&(i.type="zoom"),i.manipulator.move("zoom"===i.type?null:e,a),d.trigger("move"),b()})).on("zoomend",(function(){i.manipulator.end(),"click"===i.type?(console.log("位置：",i.startMouse),console.log("经纬度：",a.projection.invert(i.startMouse)||[]),d.trigger("click",i.startMouse,a.projection.invert(i.startMouse)||[])):"spurious"!==i.type&&(console.log(3434),l()),i=null,b()})),l=_.debounce((function(){(!i||"drag"!==i.type&&"zoom"!==i.type)&&(s.save({orientation:a.orientation()},{source:"moveEnd"}),d.trigger("moveEnd"))}),t.MOVE_END_WAIT);function c(){var t=arguments[3]||{};a&&"moveEnd"!==t.source&&(d.trigger("moveStart"),a.orientation(s.get("orientation"),e),r.scale(a.projection.scale()),d.trigger("moveEnd"))}d3.select("#display").call(r),d3.select("#show-location").on("click",(function(){if(navigator.geolocation){n.status("查找当前位置中..."),n.status("");var e=t.coord,i=a.locate(e);console.log(i,a.orientation(),a.projection(e)),i&&(a.projection.rotate(i),s.save({orientation:a.orientation()})),d.trigger("click",a.projection(e),e)}}));var d=_.extend({globe:function(t){return t&&(a=t,r.scaleExtent(a.scaleExtent()),c()),t?this:a}},Backbone.Events);return d.listenTo(s,"change:orientation",c)}function h(t){console.log("服务返回结果------",t),b(!0)}function b(t){var e=l.value();if(e){var a=e.projection([-90,0]),n=e.projection([-80,0]),i=e.projection([-90,-10]),o=e.projection([-80,-10]),r="M ".concat(a[0]," ").concat(a[1]," L").concat(n[0]," ").concat(n[1]," L").concat(o[0]," ").concat(o[1]," L").concat(i[0]," ").concat(i[1]," z"),c=d3.select(".location-mark2");c.node()||(c=d3.select("#foreground").append("path").attr("class","location-mark2")),c.datum({}).attr("d",r),t&&setTimeout((function(){e.projection.rotate([90,0]),s.save({orientation:e.orientation()})}),500)}}function g(t){var e=this.cancel;return n.status("正在下载..."),µ.loadJson(t).then((function(n){if(console.log(n,"结果结果-----------------------------",t),e.requested)return null;a.time("building meshes");var i=n.objects,s=topojson.feature(n,µ.isMobile()?i.coastline_tiny:i.coastline_110m),o=topojson.feature(n,µ.isMobile()?i.coastline_110m:i.coastline_50m),r=topojson.feature(n,µ.isMobile()?i.lakes_tiny:i.lakes_110m),l=topojson.feature(n,µ.isMobile()?i.lakes_110m:i.lakes_50m);return a.timeEnd("building meshes"),{coastLo:s,coastHi:o,lakesLo:r,lakesHi:l}}))}function y(t){var a=globes.get(t);return a?when(a(e)):when.reject("Unknown projection: "+t)}console.log(p);var C=0;function w(){n.status("正在下载..."),a.time("build grids");var t=this.cancel;C++;var e=when.map(products.productsFor(s.attributes),(function(e){return e.load(t,h)}));return when.all(e).then((function(t){return a.time("build grids"),{primaryGrid:t[0],overlayGrid:t[1]||t[0]}})).ensure((function(){C--}))}function x(t){if(C>0)a.debug("Download in progress--ignoring nav request.");else{var e=c.value().primaryGrid.navigate(t);e&&s.save(µ.dateToConfig(e))}}function E(t,e){if(!t||!e)return null;n.status("渲染地图中..."),a.time("rendering map");var i=_.clone(Backbone.Events);d._previous&&d._previous.stopListening(),d._previous=i,µ.removeChildren(d3.select("#map").node()),µ.removeChildren(d3.select("#foreground").node()),e.defineMap(d3.select("#map"),d3.select("#foreground"));var s=d3.geo.path().projection(e.projection).pointRadius(7),r=d3.select(".coastline"),l=d3.select(".lakes");function c(t,e){if((!u.value()||u.value().isInsideBoundary(t[0],t[1]))&&e&&_.isFinite(e[0])&&_.isFinite(e[1])){var a=d3.select(".location-mark");a.node()||(a=d3.select("#foreground").append("path").attr("class","location-mark")),a.datum({type:"Point",coordinates:e}).attr("d",s)}}d3.selectAll("path").attr("d",s),G.point&&G.coord&&c(G.point,G.coord);var v=5,f=_.throttle(p,v,{leading:!1});function p(){d3.selectAll("path").attr("d",s),d.trigger("redraw"),f=_.throttle(p,v,{leading:!1})}return i.listenTo(o,{moveStart:function(){r.datum(t.coastLo),l.datum(t.lakesLo),d.trigger("start")},move:function(){f()},moveEnd:function(){r.datum(t.coastHi),l.datum(t.lakesHi),d3.selectAll("path").attr("d",s),d.trigger("render")},click:c}),when(!0).then((function(){o.globe(e)})),a.timeEnd("rendering map"),"ready"}function T(t){if(!t)return null;a.time("render mask");var n=e.width,i=e.height,s=d3.select(document.createElement("canvas")).attr("width",n).attr("height",i).node(),o=t.defineMask(s.getContext("2d"));o.fillStyle="rgba(255, 0, 0, 1)",o.fill();var r=o.getImageData(0,0,n,i),l=r.data;return a.timeEnd("render mask"),{imageData:r,isVisible:function(t,e){var a=4*(e*n+t);return l[a+3]>0},set:function(t,e,a){var i=4*(e*n+t);return l[i]=a[0],l[i+1]=a[1],l[i+2]=a[2],l[i+3]=a[3],this}}}function k(e,a,n){function i(a,n){var i=e[Math.round(a)];return i&&i[Math.round(n)]||t.NULL_WIND_VECTOR}return i.isDefined=function(t,e){return null!==i(t,e)[2]},i.isInsideBoundary=function(e,a){return i(e,a)!==t.NULL_WIND_VECTOR},i.release=function(){e=[]},i.randomize=function(t){var e,n,s=0;do{e=Math.round(_.random(a.x,a.xMax)),n=Math.round(_.random(a.y,a.yMax))}while(!i.isDefined(e,n)&&s++<30);return t.x=e,t.y=n,t},i.overlay=n.imageData,i}function M(t,e,a,n,i,s,o){var r=o[0]*s,l=o[1]*s,c=µ.distortion(t,e,a,n,i);return o[0]=c[0]*r+c[2]*l,o[1]=c[1]*r+c[3]*l,o}function A(i,s){if(!i||!s)return null;var o=T(i),r=s.primaryGrid,l=s.overlayGrid;a.time("interpolating field");var c=when.defer(),d=this.cancel,u=i.projection,v=i.bounds(e),f=v.height*r.particles.velocityScale,p=[],m=[],_=v.x,h=r.interpolate,b=l.interpolate,g=r!==l,y=l.scale;function C(e){for(var a=[],n=v.y;n<=v.yMax;n+=2)if(o.isVisible(e,n)){m[0]=e,m[1]=n;var i=u.invert(m),s=t.TRANSPARENT_BLACK,r=null;if(i){var l=i[0],c=i[1];if(isFinite(l)){r=h(l,c);var d=null;r&&(r=M(u,l,c,e,n,f,r),d=r[2]),g&&(d=b(l,c)),µ.isValue(d)&&(s=y.gradient(d,t.OVERLAY_ALPHA))}}a[n+1]=a[n]=r||t.HOLE_VECTOR,o.set(e,n,s).set(e+1,n,s).set(e,n+1,s).set(e+1,n+1,s)}p[e+1]=p[e]=a}return n.status(""),function e(){try{if(!d.requested){var i=Date.now();while(_<v.xMax)if(C(_),_+=2,Date.now()-i>t.MAX_TASK_TIME)return n.progress((_-v.x)/(v.xMax-v.x)),void setTimeout(e,t.MIN_SLEEP_TIME)}c.resolve(k(p,v,o))}catch(s){c.reject(s)}n.progress(1),a.timeEnd("interpolating field")}(),c.promise}function P(a,i,s){if(a&&i&&s){var o=this.cancel,r=a.bounds(e),l=µ.windIntensityColorScale(t.INTENSITY_SCALE_STEP,s.primaryGrid.particles.maxIntensity),c=l.map((function(){return[]})),d=Math.round(r.width*t.PARTICLE_MULTIPLIER);µ.isMobile()&&(d*=t.PARTICLE_REDUCTION);for(var u=µ.isFF()?"rgba(0, 0, 0, 0.95)":"rgba(0, 0, 0, 0.97)",v=[],f=0;f<d;f++)v.push(i.randomize({age:_.random(0,t.MAX_PARTICLE_AGE)}));var p=d3.select("#animation").node().getContext("2d");p.lineWidth=t.PARTICLE_LINE_WIDTH,p.fillStyle=u,function e(){try{if(o.requested)return void i.release();m(),h(),setTimeout(e,t.FRAME_RATE)}catch(a){n.error(a)}}()}function m(){c.forEach((function(t){t.length=0})),v.forEach((function(e){e.age>t.MAX_PARTICLE_AGE&&(i.randomize(e).age=0);var a=e.x,n=e.y,s=i(a,n),o=s[2];if(null===o)e.age=t.MAX_PARTICLE_AGE;else{var r=a+s[0],d=n+s[1];i.isDefined(r,d)?(e.xt=r,e.yt=d,c[l.indexFor(o)].push(e)):(e.x=r,e.y=d)}e.age+=1}))}function h(){var t=p.globalCompositeOperation;p.globalCompositeOperation="destination-in",p.fillRect(r.x,r.y,r.width,r.height),p.globalCompositeOperation=t,c.forEach((function(t,e){t.length>0&&(p.beginPath(),p.strokeStyle=l[e],t.forEach((function(t){p.moveTo(t.x,t.y),p.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt})),p.stroke())}))}}function I(t,e,a){if(e&&a&&s.get("showGridPoints")){t.fillStyle="rgba(255, 255, 255, 1)";var n=a.projection.stream({point:function(e,a){t.fillRect(Math.round(e),Math.round(a),1,1)}});e.forEachPoint((function(t,e,a){µ.isValue(a)&&n.point(t,e)}))}}function N(t,e){if(t){var a=d3.select("#overlay").node().getContext("2d"),n=(c.value()||{}).overlayGrid;if(µ.clearCanvas(d3.select("#overlay").node()),µ.clearCanvas(d3.select("#scale").node()),e&&("off"!==e&&a.putImageData(t.overlay,0,0),I(a,n,l.value())),n){for(var i=d3.select("#scale"),s=n.scale,o=s.bounds,r=i.node(),d=r.getContext("2d"),u=r.width-1,v=0;v<=u;v++){var f=s.gradient(µ.spread(v/u,o[0],o[1]),1);d.fillStyle="rgb("+f[0]+","+f[1]+","+f[2]+")",d.fillRect(v,0,1,r.height)}i.on("mousemove",(function(){var t=d3.mouse(this)[0],e=µ.clamp((Math.round(t)-2)/(u-2),0,1),a=µ.spread(e,o[0],o[1]),s="wind"===n.type?"#location-wind-units":"#location-value-units",r=O(s,n).value();i.attr("title",µ.formatScalar(a,r)+" "+r.label)}))}}}function S(e){var a=3*t.HOUR,n=e?e.primaryGrid.date.getTime():Math.floor(Date.now()/a)*a,i=s.get("date").split("/"),o=s.get("hour");return i.length>1?Date.UTC(+i[0],i[1]-1,+i[2],+o.substring(0,2)):"current"===i[0]?n:null}function j(t){var e=new Date(S(t)),a=d3.select("#data-date").classed("local"),n=a?µ.toLocalISO(e):µ.toUTCISO(e);d3.select("#data-date").text(n+" "+(a?"本地时间":"UTC")),d3.select("#toggle-zone").text("⇄ "+(a?"UTC":"本地时间"))}function L(t){j(t);var e="",a="";if(t){var n=d3.select("body").attr("data-lang")||"en",i=t.primaryGrid.description(n),s=t.overlayGrid.description(n);e=s.name+s.qualifier,t.primaryGrid!==t.overlayGrid&&(e=(i.qualifier===s.qualifier?i.name:i.name+i.qualifier)+" + "+e),a=t.overlayGrid.source}d3.select("#data-layer").text(e),d3.select("#data-center").text(a)}function O(t,e){var a=e.units,n=a.length,i=+(d3.select(t).attr("data-index")||0)%n;return{value:function(){return a[i]},next:function(){d3.select(t).attr("data-index",i=(i+1)%n)}}}function R(t,e){var a=O("#location-wind-units",e),n=a.value();d3.select("#location-wind").text(µ.formatVector(t,n)),d3.select("#location-wind-units").text(n.label).on("click",(function(){a.next(),R(t,e)}))}function D(t,e){var a=O("#location-value-units",e),n=a.value();d3.select("#location-value").text(µ.formatScalar(t,n)),d3.select("#location-value-units").text(n.label).on("click",(function(){a.next(),D(t,e)}))}var G={};function W(t,e){b(),t=t||[],e=e||[];var a=c.value(),n=u.value(),i=e[0],s=e[1];if(n&&n.isInsideBoundary(t[0],t[1])&&(H(!1),G={point:t,coord:e},_.isFinite(i)&&_.isFinite(s)&&(d3.select("#location-coord").text(µ.formatCoordinates(i,s)),d3.select("#location-close").classed("invisible",!1)),n.isDefined(t[0],t[1])&&a)){var o=a.primaryGrid.interpolate(i,s);if(µ.isValue(o)&&R(o,a.primaryGrid),a.overlayGrid!==a.primaryGrid){var r=a.overlayGrid.interpolate(i,s);µ.isValue(r)&&D(r,a.overlayGrid)}}}function $(){W(G.point,G.coord)}function H(t){d3.select("#location-coord").text(""),d3.select("#location-close").classed("invisible",!0),d3.select("#location-wind").text(""),d3.select("#location-wind-units").text(""),d3.select("#location-value").text(""),d3.select("#location-value-units").text(""),t&&(G={},d3.select(".location-mark").remove())}function V(t){v.cancel(),t&&µ.clearCanvas(d3.select("#animation").node())}function q(t,e,a){a=a||_.keys(e),d3.select(t).on("click",(function(){d3.select(t).classed("disabled")||(console.log(e,s.save(e)),s.save(e))})),s.on("change",(function(n){var i=n.attributes;d3.select(t).classed("highlighted",_.isEqual(_.pick(i,a),_.pick(e,a)))}))}function z(t){ga&&ga("send","event","sponsor",t)}function F(){n.status("Initializing..."),d3.select("#sponsor-link").attr("target",µ.isEmbeddedInIFrame()?"_new":null).on("click",z.bind(null,"click")).on("contextmenu",z.bind(null,"right-click")),d3.select("#sponsor-hide").on("click",(function(){d3.select("#sponsor").classed("invisible",!0)})),d3.selectAll(".fill-screen").attr("width",e.width).attr("height",e.height);var t=d3.select("#scale-label").node();function i(){d.submit(E,r.value(),l.value())}function p(){u.submit(A,l.value(),c.value())}function m(){u.cancel()}d3.select("#scale").attr("width",.97*(d3.select("#menu").node().offsetWidth-t.offsetWidth)).attr("height",t.offsetHeight/2),d3.select("#show-menu").on("click",(function(){µ.isEmbeddedInIFrame()?window.open("http://earth.nullschool.net/"+window.location.hash,"_blank"):d3.select("#menu").classed("invisible",!d3.select("#menu").classed("invisible"))})),µ.isFF()&&d3.select("#display").classed("firefox",!0),"ontouchstart"in document.documentElement?d3.select(document).on("touchstart",(function(){})):d3.select(document.documentElement).classed("no-touch",!0),d3.select(window).on("hashchange",(function(){a.debug("hashchange"),s.fetch({trigger:"hashchange"})})),s.on("change",n.reset),r.listenTo(s,"change:topology",(function(t,e){r.submit(g,e)})),l.listenTo(s,"change:projection",(function(t,e){l.submit(y,e)})),c.listenTo(s,"change",(function(){var t=_.keys(s.changedAttributes()),e=!1;_.intersection(t,["date","hour","param","surface","level"]).length>0&&(e=!0);var a=s.get("overlayType")||"default";if(_.indexOf(t,"overlayType")>=0&&"off"!==a){var n=c.value()||{},i=n.primaryGrid,o=n.overlayGrid;o&&(o.type===a||"default"===a&&i===o)||(e=!0)}e&&c.submit(w)})),c.on("submit",(function(){L(null)})),c.on("update",(function(t){L(t)})),d3.select("#toggle-zone").on("click",(function(){d3.select("#data-date").classed("local",!d3.select("#data-date").classed("local")),j(c.cancel.requested?null:c.value())})),d.listenTo(r,"update",i),d.listenTo(l,"update",i),u.listenTo(c,"update",p),u.listenTo(d,"render",p),u.listenTo(d,"start",m),u.listenTo(d,"redraw",m),v.listenTo(u,"update",(function(t){v.submit(P,l.value(),t,c.value())})),v.listenTo(d,"start",V.bind(null,!0)),v.listenTo(c,"submit",V.bind(null,!1)),v.listenTo(u,"submit",V.bind(null,!1)),f.listenTo(u,"update",(function(){f.submit(N,u.value(),s.get("overlayType"))})),f.listenTo(d,"start",(function(){f.submit(N,u.value(),null)})),f.listenTo(s,"change",(function(){var t=_.keys(s.changedAttributes());_.intersection(t,["overlayType","showGridPoints"]).length>0&&f.submit(N,u.value(),s.get("overlayType"))})),o.on("click",W),u.on("update",$),d3.select("#location-close").on("click",_.partial(H,!0)),s.on("change:param",(function(t,e){switch(d3.selectAll(".ocean-mode").classed("invisible","ocean"!==e),d3.selectAll(".ncep-mode").classed("invisible","ncep"!==e),d3.selectAll(".cma-mode").classed("invisible","cma"!==e),e){case"ncep":d3.select("#nav-backward-more").attr("title","-1 Day"),d3.select("#nav-backward").attr("title","-3 Hours"),d3.select("#nav-forward").attr("title","+3 Hours"),d3.select("#nav-forward-more").attr("title","+1 Day");break;case"cma":d3.select("#nav-backward-more").attr("title","-1 Day"),d3.select("#nav-backward").attr("title","-3 Hours"),d3.select("#nav-forward").attr("title","+3 Hours"),d3.select("#nav-forward-more").attr("title","+1 Day");break;case"ocean":d3.select("#nav-backward-more").attr("title","-1 Month"),d3.select("#nav-backward").attr("title","-5 Days"),d3.select("#nav-forward").attr("title","+5 Days"),d3.select("#nav-forward-more").attr("title","+1 Month");break}})),d3.select("#ncep-mode-enable").on("click",(function(){"ncep"!==s.get("param")&&s.save({param:"ncep",surface:"surface",level:"level",overlayType:"default"})})),s.on("change:param",(function(t,e){d3.select("#ncep-mode-enable").classed("highlighted","ncep"===e)})),d3.select("#cma-mode-enable").on("click",(function(){console.log(s.get("param")),"cma"!==s.get("param")&&s.save({param:"cma",surface:"cmasurface",level:"level",overlayType:"default"})})),s.on("change:param",(function(t,e){d3.select("#cma-mode-enable").classed("highlighted","cma"===e)})),d3.select("#ocean-mode-enable").on("click",(function(){if("ocean"!==s.get("param")){var t={param:"ocean",surface:"surface",level:"currents",overlayType:"default"},e=_.clone(s.attributes);"current"===e.date?s.save(t):when.all(products.productsFor(_.extend(e,t))).spread((function(e){e.date&&s.save(_.extend(t,µ.dateToConfig(e.date)))})).otherwise(n.error),V(!0)}})),s.on("change:param",(function(t,e){d3.select("#ocean-mode-enable").classed("highlighted","ocean"===e)})),s.on("change:overlayType",(function(t,e){d3.select("#surface-level").classed("disabled","air_density"===e||"wind_power_density"===e)})),s.on("change:surface",(function(t,e){d3.select("#overlay-air_density").classed("disabled","surface"===e),d3.select("#overlay-wind_power_density").classed("disabled","surface"===e)})),d3.select("#nav-backward-more").on("click",x.bind(null,-10)),d3.select("#nav-forward-more").on("click",x.bind(null,10)),d3.select("#nav-backward").on("click",x.bind(null,-1)),d3.select("#nav-forward").on("click",x.bind(null,1)),d3.select("#nav-now").on("click",(function(){s.save({date:"current",hour:""})})),d3.select("#option-show-grid").on("click",(function(){s.save({showGridPoints:!s.get("showGridPoints")})})),s.on("change:showGridPoints",(function(t,e){d3.select("#option-show-grid").classed("highlighted",e)})),d3.selectAll(".surface").each((function(){var t=this.id,e=t.split("-");q("#"+t,{param:"ncep",surface:e[0],level:e[1]})})),d3.selectAll(".cmasurface").each((function(){var t=this.id,e=t.split("-");q("#"+t,{param:"cma",surface:e[0],level:e[1]})})),q("#animate-currents",{param:"ocean",surface:"surface",level:"currents"}),products.overlayTypes.forEach((function(t){q("#overlay-"+t,{overlayType:t})})),q("#overlay-wind",{param:"ncep",overlayType:"default"}),q("#overlay-cmawind",{param:"cma",overlayType:"default"}),q("#overlay-currents",{overlayType:"default"}),q("#overlay-ocean-off",{overlayType:"off"}),q("#overlay-cma-off",{overlayType:"off"}),globes.keys().forEach((function(t){q("#"+t,{projection:t,orientation:""},["projection"])})),d3.select(window).on("orientationchange",(function(){e=µ.view(),l.submit(y,s.get("projection"))}))}function U(){s.fetch()}when(!0).then(F).then(U).otherwise(n.error)},handleClick:function(){console.log(0x6d5713d50dd35c00,µ)}}}),c=l,d=a("cba8"),u=Object(d["a"])(c,o,r,!1,null,"13d86691",null),v=u.exports,f={name:"App",components:{MyEarth:v},created:function(){},methods:{}},p=f,m=(a("034f"),Object(d["a"])(p,i,s,!1,null,null,null)),h=m.exports,b=a("7736"),g={name:""},y=a("63e0"),C=a.n(y),w=a("94d5"),x=a.n(w),E=a("0439"),T=a.n(E),k={name:""},M={},A={},P={},I={state:k,mutations:M,actions:A,getters:P};n["default"].use(b["a"]);var N=new b["a"].Store({state:g,actions:C.a,getters:x.a,mutations:T.a,modules:{homePage:I}}),S=a("edcc"),j=a.n(S);a("0db3");console.log(N),n["default"].config.productionTip=!1,n["default"].use(j.a),new n["default"]({store:N,render:function(t){return t(h)}}).$mount("#app")},"63e0":function(t,e){},"94d5":function(t,e){}});
//# sourceMappingURL=app.4f10bcb4.js.map